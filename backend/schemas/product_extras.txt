     1 Code for the cart.py file
        
           from fastapi import APIRouter, HTTPException, Depends
    from pydantic import BaseModel
    from typing import List
    from sqlalchemy.orm import Session
    from backend.utils.db_connection import get_db
    from backend.database.models.product import Product
    from backend.database.models.order import Order
    from backend.database.models.user import User
    
    router = APIRouter(prefix="/api/cart", tags=["Cart"])
    
    # Temporary in-memory storage (could be replaced by Redis later)
    cart_storage = {}
    
    class CartItem(BaseModel):
        product_id: int
        quantity: int
    
    class CartResponse(BaseModel):
        user_id: int
        items: List[CartItem]
        total_price: float
    
    @router.post("/add/{user_id}", response_model=CartResponse)
    def add_to_cart(user_id: int, item: CartItem, db: Session = Depends(get_db)):
        user_cart = cart_storage.get(user_id, [])
        product = db.query(Product).filter(Product.id == item.product_id).first()
    
        if not product:
            raise HTTPException(status_code=404, detail="Product not found")
    
        for existing_item in user_cart:
            if existing_item["product_id"] == item.product_id:
                existing_item["quantity"] += item.quantity
                break
        else:
            user_cart.append({"product_id": item.product_id, "quantity": item.quantity})
    
        cart_storage[user_id] = user_cart
    
        total_price = sum(
            db.query(Product).filter(Product.id == i["product_id"]).first().price * i["quantity"]
            for i in user_cart
        )
    
        return {"user_id": user_id, "items": user_cart, "total_price": total_price}
    
    @router.delete("/remove/{user_id}/{product_id}", response_model=CartResponse)
    def remove_from_cart(user_id: int, product_id: int, db: Session = Depends(get_db)):
        user_cart = cart_storage.get(user_id, [])
        user_cart = [i for i in user_cart if i["product_id"] != product_id]
        cart_storage[user_id] = user_cart
    
        total_price = sum(
            db.query(Product).filter(Product.id == i["product_id"]).first().price * i["quantity"]
            for i in user_cart
        )
    
        return {"user_id": user_id, "items": user_cart, "total_price": total_price}
    
    @router.post("/checkout/{user_id}")
    def checkout(user_id: int, db: Session = Depends(get_db)):
        user_cart = cart_storage.get(user_id, [])
    
        if not user_cart:
            raise HTTPException(status_code=400, detail="Cart is empty")
    
        total_price = sum(
            db.query(Product).filter(Product.id == i["product_id"]).first().price * i["quantity"]
            for i in user_cart
        )
    
        new_order = Order(user_id=user_id, total=total_price)
        db.add(new_order)
        db.commit()
    
        cart_storage[user_id] = []  # clear cart after checkout
    
        return {"message": "Checkout completed successfully", "order_id": new_order.id, "total": total_price}
    
     1. Make sure your backend is running
    
    In Visual Studio Code, open a terminal and run:
    
    uvicorn main:app --reload
    
    This will launch your API at:
    ðŸ‘‰ http://127.0.0.1:8000
    from fastapi import APIRouter, HTTPException, Depends
    
    In your React project, inside the src folder, create:
    
    src/
     â””â”€â”€ services/
          â””â”€â”€ cartService.js
    from pydantic import BaseModel
    from typing import List
    from sqlalchemy.orm import Session
    
    // src/services/cartService.js
    const API_URL = "http://127.0.0.1:8000/cart";
    
    export const getCart = async () => {
      const res = await fetch(API_URL);
      if (!res.ok) throw new Error("Error loading cart");
      return res.json();
    };
    
    export const addToCart = async (product_id, quantity = 1) => {
      const res = await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ product_id, quantity }),
      });
      if (!res.ok) throw new Error("Error adding to cart");
      return res.json();
    };
    
    export const updateCart = async (item_id, quantity) => {
      const res = await fetch(`${API_URL}/${item_id}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ quantity }),
      });
      if (!res.ok) throw new Error("Error updating cart");
      return res.json();
    };
    
    export const deleteFromCart = async (item_id) => {
      const res = await fetch(`${API_URL}/${item_id}`, {
        method: "DELETE",
      });
      if (!res.ok) throw new Error("Error deleting item");
      return res.json();
    };
    from ..database.connection import get_db
        db.delete(product)
        db.commit()
        return {"detail": "Product deleted successfully"}
    
        Create the cart component in React
    // src/components/Cart.js
    import React, { useState, useEffect } from "react";
    
    src/components/Cart.jsx
    
    import React, { useEffect, useState } from "react";
    import {
      getCart,
      addToCart,
      updateCart,
      deleteFromCart,
    } from "../services/cartService";
    
    export default function Cart() {
      const [cart, setCart] = useState([]);
      const [loading, setLoading] = useState(true);
    
      useEffect(() => {
        loadCart();
      }, []);
    
      const loadCart = async () => {
        try {
          const data = await getCart();
          setCart(data);
        } catch (error) {
          console.error(error);
        } finally {
          setLoading(false);
        }
      };
    
      const handleAdd = async (product_id) => {
        await addToCart(product_id);
        loadCart();
      };
    
      const handleUpdate = async (item_id, quantity) => {
        await updateCart(item_id, quantity);
        loadCart();
      };
    
      const handleDelete = async (item_id) => {
        await deleteFromCart(item_id);
        loadCart();
      };
    
      if (loading) return <p>Loading cart...</p>;
    
      return (
        <div className="p-4">
          <h2 className="text-xl font-bold mb-4">Shopping Cart</h2>
          {cart.length === 0 ? (
            <p>Your cart is empty.</p>
          ) : (
            <ul className="space-y-3">
              {cart.map((item) => (
                <li
                  key={item.id}
                  className="flex justify-between items-center bg-gray-100 p-3 rounded-lg shadow"
                >
                  <div>
                    <p className="font-semibold">{item.product.name}</p>
                    <p>${item.product.price} x {item.quantity}</p>
                  </div>
                  <div className="flex items-center gap-2">
                    <button
                      onClick={() => handleUpdate(item.id, item.quantity + 1)}
                      className="px-2 py-1 bg-green-500 text-white rounded"
                    >
                      +
                    </button>
                    <button
                      onClick={() =>
                        handleUpdate(item.id, Math.max(item.quantity - 1, 1))
                      }
                      className="px-2 py-1 bg-yellow-500 text-white rounded"
                    >
                      -
                    </button>
                    <button
                      onClick={() => handleDelete(item.id)}
                      className="px-2 py-1 bg-red-600 text-white rounded"
                    >
                      X
                    </button>
                  </div>
                </li>
              ))}
            </ul>
          )}
        </div>
      );
    }
    
    Connect the cart to your main app
    
    Edit your src/App.jsx file and add:
    
    import Cart from "./components/Cart";
    
    function App() {
      return (
        <div className="App">
          <h1 className="text-2xl font-bold text-center mt-4">
            Virtual Store
          </h1>
          <Cart />
        </div>
      );
    }
    
    export default App;
    npm start
    from ..database.connection import get_db
    
    
    1. Estructura general del backend (FastAPI)
    
    Tu proyecto ahora debe verse asÃ­:
    
    backend/
    â”‚
    â”œâ”€â”€ main.py
    â”œâ”€â”€ connection.py
    â”œâ”€â”€ models/
    â”‚   â”œâ”€â”€ user.py
    â”‚   â”œâ”€â”€ product.py
    â”‚   â””â”€â”€ cart.py
    â”œâ”€â”€ routers/
    â”‚   â”œâ”€â”€ auth.py
    â”‚   â”œâ”€â”€ products.py
    â”‚   â””â”€â”€ cart.py
    â”œâ”€â”€ schemas/
    â”‚   â”œâ”€â”€ user.py
    â”‚   â”œâ”€â”€ product.py
    â”‚   â””â”€â”€ cart.py
    â””â”€â”€ requirements.txt
    
    
    2. Archivo models/user.py
    
    from sqlalchemy import Column, Integer, String
    from connection import Base
    
    class User(Base):
        __tablename__ = "users"
    
        id = Column(Integer, primary_key=True, index=True)
        name = Column(String(100))
        email = Column(String(120), unique=True, index=True)
        password = Column(String(255))
        
    
        3. Archivo models/product.py
    
        from sqlalchemy import Column, Integer, String, Float
    from connection import Base
    
    class Product(Base):
        __tablename__ = "products"
    
        id = Column(Integer, primary_key=True, index=True)
        name = Column(String(150))
        description = Column(String(255))
        price = Column(Float)
        stock = Column(Integer)
        image = Column(String(255), nullable=True)
        def __repr__(self):
            return f"<Product(id={self.id}, name={self.name}, price_usd={self.price_usd})>"
    
            4. Archivo models/cart.py
    
            from sqlalchemy import Column, Integer, ForeignKey
    from sqlalchemy.orm import relationship
    from connection import Base
    
    class Cart(Base):
        __tablename__ = "cart"
    
        id = Column(Integer, primary_key=True, index=True)
        user_id = Column(Integer, ForeignKey("users.id"))
        product_id = Column(Integer, ForeignKey("products.id"))
        quantity = Column(Integer, default=1)
    
        user = relationship("User")
        product = relationship("Product")
    
    5. Archivo schemas/cart.py
    
    
    from pydantic import BaseModel
    from typing import Optional
    from schemas.product import ProductSchema
    
    class CartCreate(BaseModel):
        product_id: int
        quantity: Optional[int] = 1
    
    class CartUpdate(BaseModel):
        quantity: int
    
    class CartItem(BaseModel):
        id: int
        product: ProductSchema
        quantity: int
    
        class Config:
            orm_mode = True
    
    6. Archivo routers/auth.py (para manejar usuarios y tokens)
    
    
    from fastapi import APIRouter, Depends, HTTPException
    from sqlalchemy.orm import Session
    from connection import get_db
    from models.user import User
    from passlib.context import CryptContext
    from jose import jwt
    import os
    
    router = APIRouter(prefix="/auth", tags=["Auth"])
    
    SECRET_KEY = "secret123"  # Puedes reemplazarlo con un valor mÃ¡s seguro
    ALGORITHM = "HS256"
    pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto")
    
    @router.post("/register")
    def register(name: str, email: str, password: str, db: Session = Depends(get_db)):
        hashed_password = pwd_context.hash(password)
        new_user = User(name=name, email=email, password=hashed_password)
        db.add(new_user)
        db.commit()
        db.refresh(new_user)
        return {"message": "User registered successfully"}
    
    @router.post("/login")
    def login(email: str, password: str, db: Session = Depends(get_db)):
        user = db.query(User).filter(User.email == email).first()
        if not user or not pwd_context.verify(password, user.password):
            raise HTTPException(status_code=400, detail="Invalid credentials")
        
        token = jwt.encode({"user_id": user.id}, SECRET_KEY, algorithm=ALGORITHM)
        return {"access_token": token, "token_type": "bearer"}
    
    7. Archivo routers/cart.py (carrito sincronizado)
    
    from fastapi import APIRouter, Depends, HTTPException
    from sqlalchemy.orm import Session
    from jose import jwt, JWTError
    from connection import get_db
    from models.cart import Cart
    from models.product import Product
    from schemas.cart import CartCreate, CartUpdate, CartItem
    
    SECRET_KEY = "secret123"
    ALGORITHM = "HS256"
    
    router = APIRouter(prefix="/cart", tags=["Cart"])
    
    def get_current_user(token: str, db: Session):
        try:
            payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])
            user_id = payload.get("user_id")
            return user_id
        except JWTError:
            raise HTTPException(status_code=401, detail="Invalid token")
    
    @router.get("/", response_model=list[CartItem])
    def get_cart(token: str, db: Session = Depends(get_db)):
        user_id = get_current_user(token, db)
        cart = db.query(Cart).filter(Cart.user_id == user_id).all()
        return cart
    
    @router.post("/", response_model=CartItem)
    def add_to_cart(cart_data: CartCreate, token: str, db: Session = Depends(get_db)):
        user_id = get_current_user(token, db)
        existing = db.query(Cart).filter(
            Cart.user_id == user_id, Cart.product_id == cart_data.product_id
        ).first()
    
        if existing:
            existing.quantity += cart_data.quantity
            db.commit()
            db.refresh(existing)
            return existing
    
        new_item = Cart(user_id=user_id, product_id=cart_data.product_id, quantity=cart_data.quantity)
        db.add(new_item)
        db.commit()
        db.refresh(new_item)
        return new_item
    
    @router.put("/{item_id}", response_model=CartItem)
    def update_cart(item_id: int, update_data: CartUpdate, token: str, db: Session = Depends(get_db)):
        user_id = get_current_user(token, db)
        item = db.query(Cart).filter(Cart.id == item_id, Cart.user_id == user_id).first()
        if not item:
            raise HTTPException(status_code=404, detail="Item not found")
        item.quantity = update_data.quantity
        db.commit()
        db.refresh(item)
        return item
    
    @router.delete("/{item_id}")
    def delete_cart_item(item_id: int, token: str, db: Session = Depends(get_db)):
        user_id = get_current_user(token, db)
        item = db.query(Cart).filter(Cart.id == item_id, Cart.user_id == user_id).first()
        if not item:
            raise HTTPException(status_code=404, detail="Item not found")
        db.delete(item)
        db.commit()
        return {"message": "Item removed from cart"}
    
    
    8. Archivo main.py
    
    from fastapi import FastAPI
    from connection import Base, engine
    from routers import auth, products, cart
    
    app = FastAPI(title="Virtual Store API")
    
    Base.metadata.create_all(bind=engine)
    
    app.include_router(auth.router)
    app.include_router(products.router)
    app.include_router(cart.router)
    
    
    9. Archivo connection.py
    
    from sqlalchemy import create_engine
    from sqlalchemy.ext.declarative import declarative_base
    from sqlalchemy.orm import sessionmaker
    
    DATABASE_URL = "sqlite:///./store.db"
    
    engine = create_engine(DATABASE_URL, connect_args={"check_same_thread": False})
    SessionLocal = sessionmaker(bind=engine, autoflush=False, autocommit=False)
    Base = declarative_base()
    
    def get_db():
        db = SessionLocal()
        try:
            yield db
        finally:
            db.close()
    
    
    10. Archivo requirements.txt
    
    fastapi
    uvicorn
    sqlalchemy
    python-jose
    passlib[bcrypt]
    pydantic
    from ..database.connection import get_db
